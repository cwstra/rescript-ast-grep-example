id: rescript-is-react-state-binding
language: rescript
rule:
  matches: rescript-in-react-function-context
  kind: value_identifier
  any:
    - nthChild: 1
      inside:
        matches: rescript-is-react-function-context
    - inside:
        kind: formal_parameters
        stopBy:
          kind: formal_parameters
        inside:
          matches: rescript-is-react-function-context
    - all:
        - matches: rescript-in-react-function-context
        - matches: is-let-bound-value

utils:
  is-let-bound-value:
    any:
      - matches: rescript-let-binding-pattern
        inside:
          matches: uses-react-data
      - inside:
          matches: rescript-let-binding-pattern
          stopBy:
            kind: let_binding
          inside:
            matches: uses-react-data
  uses-react-data:
    has:
      nthChild: 2
      any:
        - matches: is-reference-or-hook
        - has:
            stopBy: end
            matches: is-reference-or-hook
  is-reference-or-hook:
    any:
      - matches: rescript-hook-call
      - matches: is-react-state-reference
